#======================================================================================================================
# LanguageInfo
#======================================================================================================================
package ePages::LanguageInfo ;

use strict ;

#======================================================================================================================
# §function     new
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       ePages->new( $System ) ;
#----------------------------------------------------------------------------------------------------------------------
# §description  Constructor
#----------------------------------------------------------------------------------------------------------------------
# §return       $Object | The new object instance | Object
#======================================================================================================================
sub new {
    my $class = shift;

    my ( $System ) = @_ ;

    my $self = bless({ 'System' => $System }, $class ) ;
    $self->loadLanguageInfo() ;
    
    return $self ;
}

#======================================================================================================================
# §function     loadLanguageInfo
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       LanguageInfo->loadLanguageInfo() ;
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#======================================================================================================================
sub loadLanguageInfo {
    my $self = shift;

    my $System = $self->{'System'} ;
    if ( defined $System ) {
        my $SysLanguage = $System->get([ 'LanguageID', 'Languages' ]) ;
        my $DefaultLanguageID = $SysLanguage->{'LanguageID'} ;
        my $Languages = {} ;
        for my $Language ( @{$SysLanguage->{'Languages'}} ) {
            my $LanguageID      = $Language->{'LanguageID'} ;
            my $LanguageCode    = $Language->{'Code2'} ;
            my $LanguageName    = $Language->{'English'} ;
            $Languages->{$LanguageCode} = {
                'ID'    => $LanguageID,
                'Code'  => $LanguageCode,
                'Name'  =>  $LanguageName
            } ;
            if ( $LanguageID == $DefaultLanguageID ) {
                $self->{'Default'} = $LanguageCode ;
            }
        }
        $self->{'Languages'} = $Languages ;
    } else {
        $self->reset() ;
    }

    return ;
}

#======================================================================================================================
# §function     reset
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       ePages->reset() ;
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#======================================================================================================================
sub reset {
    my $self = shift;

    $self->{'Default'}      = undef ;
    $self->{'Languages'}    = undef ;
    
    return ;
}

#======================================================================================================================
# §function     getDefaultCode
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       $Default = $LanguageInfo->getDefaultCode() ;
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#======================================================================================================================
sub getDefaultCode {
    my $self = shift;

    return $self->{'Default'} ;
}

#======================================================================================================================
# §function     getLanguages
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       $hLanguages = $LanguageInfo->getLanguages() ;
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#======================================================================================================================
sub getLanguages {
    my $self = shift;

    return $self->{'Languages'} ;
}

#======================================================================================================================
# §function     existLanguage
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       $Exist = $LanguageInfo->existLanguage( $LanguageCode ) ;
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#======================================================================================================================
sub existLanguage {
    my $self = shift;

    my ( $LanguageCode ) = @_ ;

    return defined $self->getLanguage( $LanguageCode ) ;
}

#======================================================================================================================
# §function     getLanguage
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       $Language = $LanguageInfo->getLanguage( $LanguageCode ) ;
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#======================================================================================================================
sub getLanguage {
    my $self = shift;

    my ( $LanguageCode ) = @_ ;

    my $Languages = $self->{'Languages'} ;
    if ( defined $Languages ) {
        $LanguageCode = $LanguageCode // $self->{'Default'} ;
        if ( defined $LanguageCode ) {
            my $Language = $Languages->{$LanguageCode} ;
            if ( defined $Language ) {
                return $Language ;
            }
        }
    }

    return undef ;
}

1;
