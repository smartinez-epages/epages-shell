#======================================================================================================================
# CommandParameters
#
#   TODO
#======================================================================================================================
package Shell::Command::CommandParameters;

use strict;

use Getopt::Long qw ( 
    GetOptionsFromArray 
    GetOptionsFromString 
) ;

#======================================================================================================================
# §function     new
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       CommandParameters->new($hAttributes)
#----------------------------------------------------------------------------------------------------------------------
# §description  Constructor
#----------------------------------------------------------------------------------------------------------------------
# §input        $hAttributes |TODO | hash.ref
#----------------------------------------------------------------------------------------------------------------------
# §return       $Object | The new object instance | Object
#======================================================================================================================
sub new {
    my $Class = shift;
    my ($hCommandMetadata) = @_ ;
    
    my $hAttributes = {
        'Metadata'      => $hCommandMetadata,
        'Parameters'    => undef,
        'Arguments'     => undef,
    } ;
    
    return bless( $hAttributes, $Class );
}

#======================================================================================================================
# §function     update
# §state        public
#======================================================================================================================
sub update {
    my ($self) = shift;

print "PARAMETERS UPDATE !!!\n";
    $self->{'Parameters'} = undef;
}

#======================================================================================================================
# §function     reset
# §state        public
#======================================================================================================================
sub reset {
    my ($self) = shift;
    
    $self->{'Arguments'} = undef;
}

#======================================================================================================================
# §function     getParameters
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       $CommandParameters->getParameters()
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#----------------------------------------------------------------------------------------------------------------------
# §return       $Arguments | TODO | hash.ref
#======================================================================================================================
sub getParameters {
    my $self = shift;

    return $self->{'Parameters'} ;
}

#======================================================================================================================
# §function     addParameters
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       $CommandParameters->addParameters($ParameterName, $ParameterInfo)
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#----------------------------------------------------------------------------------------------------------------------
# §return       $Arguments | TODO | hash.ref
#======================================================================================================================
sub addParameters {
    my $self = shift;
    my ($hParameters) = @_;

    foreach my $ParameterName (keys(%$hParameters)) {
        $self->addParameter($ParameterName, $hParameters->{$ParameterName});
    }

    return;
}

#======================================================================================================================
# §function     addParameter
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       $CommandParameters->addParameters($ParameterName, $ParameterInfo)
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#----------------------------------------------------------------------------------------------------------------------
# §return       $Arguments | TODO | hash.ref
#======================================================================================================================
sub addParameter {
    my $self = shift;
    my ($ParameterName, $ParameterInfo) = @_;
    
    my $hParameters = $self->{'Parameters'};
    $hParameters->{$ParameterName} = $ParameterInfo;
    
    return;
}

#======================================================================================================================
# §function     getArguments
# §state        public
#----------------------------------------------------------------------------------------------------------------------
# §syntax       $Arguments->getArguments()
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#----------------------------------------------------------------------------------------------------------------------
# §return       $Arguments | TODO | hash.ref
#======================================================================================================================
sub getArguments {
    my $self = shift;

    return $self->{'Arguments'} ;
}

#======================================================================================================================
# §function     parseFromString
# §state        private
#----------------------------------------------------------------------------------------------------------------------
# §syntax       $Arguments->parseFromString( $InputString )
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#----------------------------------------------------------------------------------------------------------------------
# §input        $Arguments | TODO | string
#======================================================================================================================
sub parseFromString {
    my $self = shift;

    my ( $InputString ) = @_ ;

    my $hGetOptionsData = $self->_prepareGetOptionsData()  ;
    my $hArguments  = $hGetOptionsData->{'Arguments'} ;
    my $aGetOptList = $hGetOptionsData->{'GetOptList'} ;
    
    my ( $ret, $args ) =    GetOptionsFromString( 
                                $InputString, 
                                @$aGetOptList 
                            ) ;

    $hArguments->{'@'} = $args ;
    $self->{'Arguments'} = $hArguments ;
     
    return $hArguments ;
}

#======================================================================================================================
# §function     parseFromArray
# §state        private
#----------------------------------------------------------------------------------------------------------------------
# §syntax       $Arguments->parseFromArray( $aInputArray )
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#----------------------------------------------------------------------------------------------------------------------
# §input        $Arguments | TODO | string
#======================================================================================================================
sub parseFromArray {
    my $self = shift;

    my ( $aInputArray ) = @_ ;

    my $hGetOptionsData = $self->_prepareGetOptionsData()  ;
    my $hArguments  = $hGetOptionsData->{'Arguments'} ;
    my $aGetOptList = $hGetOptionsData->{'GetOptList'} ;
    
    GetOptionsFromArray(
        $aInputArray,
        @$aGetOptList 
    ) ;

    $hArguments->{'@'} = $aInputArray ;
    $self->{'Arguments'} = $hArguments ;

    return $hArguments ;
}

#======================================================================================================================
# §function     _prepareGetOptionsData
# §state        private
#----------------------------------------------------------------------------------------------------------------------
# §syntax       $CommandParameters->_prepareGetOptionsData()
#----------------------------------------------------------------------------------------------------------------------
# §description  TODO
#----------------------------------------------------------------------------------------------------------------------
# §input        $Arguments | TODO | string
#======================================================================================================================
sub _prepareGetOptionsData {
    my $self = shift;

    my $hArguments = { '@' => [] }  ;
    my $GetOptsList = [] ;
    my $ArgumentsMetaData = $self->{'Parameters'} ;

    foreach my $ArgumentName ( keys %$ArgumentsMetaData ) {
        my $ArgumentItem = $ArgumentsMetaData->{$ArgumentName} ;
        $hArguments->{$ArgumentName} = $ArgumentItem->[1] ;
        push (
            @$GetOptsList , 
            $ArgumentItem->[0] => \$hArguments->{$ArgumentName} 
        );
    }

    return {
        'Arguments'     => $hArguments,
        'GetOptList'    => $GetOptsList
    }
}

1;
